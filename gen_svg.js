import fs from 'fs';

const svgCode = `<?xml version="1.0" encoding="utf-8" ?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1312" height="736" viewBox="0 0 1312 736"><path d="M0 0L1312 0L1312 736L0 736L0 0Z"/><path fill="#A8504B" d="M717.321 184.539C723.857 183.933 769.97 183.607 772.638 185.462C774.962 192.464 774.394 233.33 774.043 243.95C773.361 264.57 776.398 300.539 772.433 319.53C766.693 318.707 758.915 316.548 753.173 315.041C755.181 281.136 754.04 237.816 754.025 203.037L734.888 203.052L734.884 270.807C734.905 282.013 735.535 300.9 734.022 311.195C732.818 319.27 730.338 327.103 726.674 334.4C716.116 355.7 699.579 368.127 677.481 375.617C669.93 377.479 663.715 378.376 655.865 378.312C634.817 378.252 614.662 369.798 599.871 354.825C580.168 334.695 577.346 314.214 577.603 287.779C583.575 287.566 590.309 287.73 596.34 287.749C596.377 296.608 596.099 305.019 598.132 313.698C601.868 329.284 611.679 342.73 625.383 351.044C638.882 359.129 655.012 361.603 670.314 357.936C680.36 355.488 689.573 350.408 697.004 343.219C720.051 321.252 715.701 295.892 715.652 266.18L715.641 206.592C715.619 200.87 714.312 188.972 717.321 184.539Z"/><path fill="#FEFDFC" d="M764.564 461.011C784.374 459.972 801.282 475.173 802.347 494.979C803.411 514.785 788.231 531.711 768.424 532.801C748.581 533.894 731.615 518.681 730.548 498.838C729.481 478.995 744.718 462.052 764.564 461.011Z"/><path d="M760.792 472.728C774.199 469.614 787.573 478.028 790.569 491.461C793.565 504.893 785.032 518.191 771.573 521.068C758.279 523.91 745.18 515.507 742.222 502.24C739.263 488.974 747.551 475.803 760.792 472.728Z"/><path fill="#FEFDFC" d="M555.419 476.804C564.281 477.248 565.133 478.866 572.975 482.827C573.202 481.388 573.421 480.247 573.753 478.827C575.948 478.007 581.474 478.406 584.103 478.465C584.192 490.315 585.61 528.421 582.262 537.462C579.995 543.71 575.244 548.743 569.137 551.367C561.718 554.631 551.929 554.58 544.449 551.588C540.058 549.832 529.834 540.946 532.08 535.642L534.124 535.173C535.982 535.186 542.029 535.168 542.494 535.908C548.618 545.665 564.816 546.319 570.764 535.67C572.818 531.994 572.89 530.165 573.592 525.051C562.985 533.143 551.195 534.635 540.058 526.137C534.329 521.769 530.602 515.276 529.721 508.126C527.463 490.867 538.59 478.707 555.419 476.804Z"/><path d="M553.782 487.917C562.881 486.135 571.7 492.069 573.476 501.168C575.253 510.266 569.312 519.081 560.211 520.851C551.118 522.62 542.313 516.686 540.538 507.596C538.764 498.506 544.692 489.697 553.782 487.917Z"/><path fill="#A8504B" d="M542.873 184.107C559.667 184.431 576.692 183.475 593.346 184.854C595.81 185.058 596.986 187.842 596.563 189.611C594.541 198.08 600.806 226.529 592.667 229.979C584.124 230.018 544.067 231.57 539.99 227.664C537.736 222.411 538.543 193.921 539.346 186.682C539.498 185.317 541.605 184.563 542.873 184.107Z"/><path fill="#FEFDFC" d="M613.444 477.368C635.368 475.507 646.554 487.629 645.724 508.998L603.368 509.272C608.467 523.313 623.039 527.617 632.823 515.726L644.293 515.7C637.999 531.077 621.768 536.688 606.804 529.659C588.734 521.171 587.087 492.489 603.642 481.566C607.039 479.325 609.585 478.544 613.444 477.368Z"/><path d="M614.261 487.569C625.364 486.012 630.423 489.527 634.667 499.569L624.389 499.592L603.386 499.64C605.742 492.964 607.707 490.443 614.261 487.569Z"/><path fill="#FEFDFC" d="M891.155 477.307C893.076 477.174 895.024 477.071 896.949 477.157C904.055 477.433 910.752 480.554 915.533 485.819C922.021 492.998 922.572 500.169 922.116 509.147C907.928 509.001 893.74 509.005 879.552 509.157C884.882 523.275 899.335 527.438 909.569 515.694L920.672 515.901C920.169 517.059 919.614 518.194 919.01 519.303C911.588 532.73 894.96 536.399 882.067 528.759C875.734 525.013 871.188 518.862 869.468 511.708C867.621 503.956 868.965 495.787 873.199 489.035C877.703 481.943 883.246 479.076 891.155 477.307Z"/><path d="M891.201 487.585C902.613 486.863 906.503 489.2 911.33 499.509L900.514 499.589C895.377 499.458 884.934 500.67 881.473 498.538C879.674 493.815 887.623 489.176 891.201 487.585Z"/><path fill="#FEFDFC" d="M494.287 458.934C496.01 458.804 496.125 458.744 497.693 459.361C498.677 460.847 498.244 466.593 498.179 468.73C497.755 482.728 499.536 496.989 497.003 510.821C494.53 524.322 481.222 532.854 467.955 532.627C432.158 530.904 436.897 500.394 437.073 474.973L437.248 459.223L448.414 459.279C448.434 471.209 446.201 503.295 451.159 512.466C453.428 516.661 457.314 519.616 461.868 520.947C466.967 522.438 472.733 522.031 477.42 519.451C480.859 517.557 483.736 514.305 485.129 510.626C488.654 501.321 486.76 480.941 486.664 470.363C486.632 466.946 486.272 463.016 487.24 459.722C489.034 458.81 492.143 458.98 494.287 458.934Z"/><path fill="#FEFDFC" d="M832.459 477.312C866.355 474.669 860.344 507.241 860.271 530.419L849.378 530.409C849.376 525.081 849.482 519.69 849.354 514.368C849.062 502.188 851.456 488.53 835.61 487.072C817.281 489.518 822.461 516.145 822.473 530.414L811.562 530.399C811.33 513.081 811.552 495.281 811.593 477.928C813.959 477.927 820.039 477.557 821.662 478.612L822.099 482.071C822.441 482.06 830.481 477.926 832.459 477.312Z"/><path fill="#FEFDFC" d="M675.438 477.322C709.279 474.793 703.016 507.305 702.813 530.497L692.235 530.459C692.122 524.933 692.285 519.167 692.283 513.646C692.28 500.185 693.841 487.305 676.516 487.274C660.307 492.563 664.969 515.995 665.076 530.437L654.28 530.474C653.998 512.947 654.039 495.417 654.404 477.892C657.535 477.864 660.666 477.897 663.795 477.99C665.733 479.583 663.925 479.962 665.288 482.627C668.581 480.544 671.038 478.837 674.755 477.552L675.438 477.322Z"/><path fill="#A8504B" d="M486.414 215.297C500.876 215.12 497.851 220.687 504.798 229.739C508.731 234.864 516.256 241.751 521.357 245.806C536.029 246.419 551.129 245.62 565.815 246.084C571.471 246.263 583.355 243.958 586.784 248.164C586.87 250.283 587.252 250.513 586.211 251.994C583.459 252.468 575.461 252.3 572.238 252.299L519.086 252.244C515.957 250.069 503.98 238.428 500.554 235.202C495.902 239.697 490.421 242.534 483.959 239.801C480.763 238.42 478.264 235.8 477.037 232.542C473.804 224.085 478.67 218.109 486.414 215.297Z"/><path d="M486.754 222.176C489.979 220.981 493.569 222.575 494.845 225.768C496.121 228.962 494.617 232.59 491.456 233.945C489.339 234.853 486.897 234.541 485.076 233.132C483.256 231.722 482.343 229.436 482.691 227.16C483.04 224.884 484.595 222.976 486.754 222.176Z"/><path fill="#A8504B" d="M493.318 255.662C502.902 255.243 505.743 256.79 510.993 264.768C535.073 266.254 560.518 264.09 584.696 265.253C585.996 265.315 586.63 266.548 587.233 267.47C587.015 269.577 587.33 268.769 585.915 270.503C583.147 272.179 572.119 271.374 568.395 271.306C549.051 271.192 529.707 271.228 510.363 271.415C507.733 278.537 501.275 283.216 493.617 280.694C490.02 279.477 487.063 276.866 485.411 273.447C481.485 265.424 485.846 259.004 493.318 255.662Z"/><path d="M495.218 262.296C498.384 261.173 501.868 262.775 503.077 265.908C504.287 269.042 502.781 272.569 499.682 273.863C497.6 274.733 495.209 274.403 493.44 273.003C491.671 271.602 490.803 269.351 491.172 267.125C491.542 264.899 493.091 263.05 495.218 262.296Z"/><path fill="#FEFDFC" d="M509.954 458.7L520.458 458.815C521.213 480.956 520.973 508.509 520.642 530.752L510.07 530.767C509.429 507.983 509.708 481.496 509.954 458.7Z"/><path fill="#A8504B" d="M715.958 375.827C719.374 377.732 726.599 387.881 729.362 391.545C722.616 397.691 712.42 403.035 704.38 407.088C701.646 408.166 702.004 408.509 699.535 408.033C695.867 404.996 693.24 394.307 691.632 389.436C702.158 385.217 706.871 382.455 715.958 375.827Z"/><path fill="#A8504B" d="M641.663 395.404C652.841 396.249 659.869 396.117 670.909 395.529C671.518 399.989 673.522 410.268 672.808 414.762C672.691 415.496 671.608 415.708 670.702 416.094C658.661 417.64 651.086 417.526 639.189 416.074C639.49 409.317 640.581 402.064 641.663 395.404Z"/><path fill="#A8504B" d="M595.585 375.83C605.04 381.962 610.571 384.631 620.689 389.273C619.331 393.235 616.003 404.712 613.279 407.962C612.778 408.561 611.948 408.152 610.963 407.952C601.865 404.083 590.457 397.935 583.077 391.387C586.377 386.692 591.831 379.976 595.585 375.83Z"/><path fill="#A8504B" d="M745.682 336.646C752.166 339.549 758.301 342.28 764.626 345.552C760.599 356.023 756.132 363.303 749.59 372.422L749.193 372.6C745.872 372.413 734.748 362.696 731.908 360.038C737.67 351.601 741.018 345.6 745.682 336.646Z"/><path fill="#A8504B" d="M566.243 336.903C567.428 337.94 578.981 357.973 580.57 360.697C576.933 364.126 568.373 370.914 564.088 373.116C557.928 366.06 551.519 354.182 548.066 345.538C553.603 342.632 560.504 339.604 566.243 336.903Z"/><path fill="#A8504B" d="M540.772 288.572C546.933 288.462 553.367 288.642 559.55 288.728C559.206 298.661 560.451 305.292 560.585 314.724C559.138 316.431 559.076 316.016 556.552 316.747C551.206 317.852 545.845 318.887 540.472 319.852C539.554 314.562 537.78 293.821 539.294 289.143L540.772 288.572Z"/></svg>`;

const regex = /<path([^>]*?)d="([^"]+)"\/>/g;
let match;
let paths = [];
while ((match = regex.exec(svgCode)) !== null) {
    paths.push({ attrs: match[1], d: match[2] });
}

// Remove background
paths = paths.filter(p => p.d !== 'M0 0L1312 0L1312 736L0 736L0 0Z');

// Combine paths where there is a fill and the NEXT path has no fill
let combinedPaths = [];
for (let i = 0; i < paths.length; i++) {
    let p = paths[i];
    if (p.attrs.includes('fill="')) {
        // Has fill. Check next
        if (i + 1 < paths.length && !paths[i + 1].attrs.includes('fill=')) {
            // Next is a hole!
            p.d += ' ' + paths[i + 1].d;
            p.attrs += ' fill-rule="evenodd" ';
            i++; // Skip next
        }
    }
    combinedPaths.push(p);
}

let newPathsHtml = '';
combinedPaths.forEach(p => {
    let styleClass = '';
    if (p.attrs.includes('#A8504B')) {
        styleClass = 'class="draw-red" pathLength="100"';
    } else {
        styleClass = 'class="draw-dark" pathLength="100"';
    }
    // Replace white color with dark slate for text
    let d = p.d;
    let attrs = p.attrs.replace('#FEFDFC', '#1E293B');
    newPathsHtml += `<path ${attrs} ${styleClass} d="${d}" />\n`;
});

const finalSvg = `<?xml version="1.0" encoding="utf-8" ?>
<svg xmlns="http://www.w3.org/2000/svg" width="1312" height="736" viewBox="0 0 1312 736">
  <style>
    .draw-red {
      fill: #A8504B;
      stroke: #A8504B;
      stroke-width: 3;
      fill-opacity: 0;
      stroke-dasharray: 100;
      stroke-dashoffset: 100;
      animation: sketch 2.5s ease-in-out forwards, fillIn 1s ease 2.5s forwards;
    }
    .draw-dark {
      fill: #1E293B;
      stroke: #1E293B;
      stroke-width: 3;
      fill-opacity: 0;
      stroke-dasharray: 100;
      stroke-dashoffset: 100;
      animation: sketch 2.5s ease-in-out forwards, fillIn 1s ease 2.5s forwards;
    }
    
    @keyframes sketch {
      from { stroke-dashoffset: 100; }
      to { stroke-dashoffset: 0; }
    }
    @keyframes fillIn {
      from { fill-opacity: 0; }
      to { fill-opacity: 1; stroke-width: 0; }
    }
  </style>
  ${newPathsHtml}
</svg>`;

fs.writeFileSync('src/assets/logo-animated.svg', finalSvg);
console.log("Written!");
